<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Estimate Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: system-ui, -apple-system, sans-serif; 
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 20px; }
        .input-field { 
            width: 100%; 
            padding: 8px 12px; 
            border: 2px solid #e5e7eb; 
            border-radius: 6px; 
            font-size: 14px;
            transition: border-color 0.2s;
        }
        .input-field:focus { 
            outline: none; 
            border-color: #3b82f6; 
        }
        .btn { 
            padding: 10px 20px; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.2s;
            border: none;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-green { background: #059669; color: white; }
        .btn-green:hover { background: #047857; }
        .btn-red { background: #dc2626; color: white; }
        .btn-red:hover { background: #b91c1c; }
        .total-card { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            text-align: center;
            padding: 30px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; }
        tr:hover { background: #f0f9ff; }
        .setup-wizard {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .wizard-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
        }
        .step.active { background: #3b82f6; color: white; }
        .step.inactive { background: #e5e7eb; color: #6b7280; }
        .form-group { margin-bottom: 20px; }
        .label { display: block; margin-bottom: 5px; font-weight: 600; color: #374151; }
    </style>
</head>
<body>
    <div id="app">
        <!-- Setup Wizard -->
        <div id="setupWizard" class="setup-wizard">
            <div class="wizard-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="background: #3b82f6; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: white; font-size: 36px;">üèóÔ∏è</span>
                    </div>
                    <h1 style="color: #1f2937; margin-bottom: 10px;">Project Setup</h1>
                    <p style="color: #6b7280;">Let's configure your estimate for accuracy</p>
                </div>

                <div class="step-indicator">
                    <div class="step active" id="step1">1</div>
                    <div class="step inactive" id="step2">2</div>
                    <div class="step inactive" id="step3">3</div>
                </div>

                <!-- Step 1: Project Info -->
                <div id="stepContent1">
                    <h2 style="margin-bottom: 20px;">Project Information</h2>
                    <div class="form-group">
                        <label class="label">Project Name</label>
                        <input type="text" id="projectName" class="input-field" value="Commercial Construction Project" placeholder="Enter project name">
                    </div>
                    <div class="form-group">
                        <label class="label">Project Type</label>
                        <select id="projectType" class="input-field">
                            <option value="Commercial">Commercial</option>
                            <option value="Residential">Residential</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Infrastructure">Infrastructure</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="label">State/Location</label>
                        <select id="projectLocation" class="input-field">
                            <option value="">Select State</option>
                            <option value="California">California</option>
                            <option value="Texas">Texas</option>
                            <option value="New York">New York</option>
                            <option value="Florida">Florida</option>
                            <option value="Illinois">Illinois</option>
                            <option value="Nevada">Nevada</option>
                            <option value="Arizona">Arizona</option>
                            <option value="Colorado">Colorado</option>
                            <option value="Washington">Washington</option>
                            <option value="Oregon">Oregon</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Labor Rates -->
                <div id="stepContent2" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Labor Rates Configuration</h2>
                    <p style="color: #6b7280; margin-bottom: 20px;">Set your labor rates for this project</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label class="label">Project Manager ($/hr)</label>
                            <input type="number" id="rate_manager" class="input-field" value="150">
                        </div>
                        <div class="form-group">
                            <label class="label">Superintendent ($/hr)</label>
                            <input type="number" id="rate_super" class="input-field" value="100">
                        </div>
                        <div class="form-group">
                            <label class="label">General Foreman ($/hr)</label>
                            <input type="number" id="rate_general" class="input-field" value="95">
                        </div>
                        <div class="form-group">
                            <label class="label">Foreman ($/hr)</label>
                            <input type="number" id="rate_foreman" class="input-field" value="90">
                        </div>
                        <div class="form-group">
                            <label class="label">Journeyman ($/hr)</label>
                            <input type="number" id="rate_journey" class="input-field" value="85">
                        </div>
                        <div class="form-group">
                            <label class="label">Apprentice ($/hr)</label>
                            <input type="number" id="rate_apprentice" class="input-field" value="60">
                        </div>
                    </div>
                </div>

                <!-- Step 3: Project Settings -->
                <div id="stepContent3" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Project Settings</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label class="label">Profit Margin (%)</label>
                            <input type="number" id="profitMargin" class="input-field" value="15" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="label">Sales Tax (%)</label>
                            <input type="number" id="salesTax" class="input-field" value="8.25" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="label">Miscellaneous (%)</label>
                            <input type="number" id="miscPercent" class="input-field" value="5" step="0.1">
                        </div>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                    <button class="btn btn-primary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">Previous</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">Next</button>
                    <button class="btn btn-green" id="startBtn" onclick="startEstimating()" style="display: none;">Start Estimating</button>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" style="display: none;">
            <div class="container">
                <!-- Header -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: #3b82f6; padding: 15px; border-radius: 12px;">
                                <span style="color: white; font-size: 32px;">üèóÔ∏è</span>
                            </div>
                            <div>
                                <h1 style="margin: 0; color: #1f2937; font-size: 28px;">Construction Estimate Calculator</h1>
                                <p style="margin: 5px 0 0 0; color: #6b7280;" id="projectInfo">Commercial Construction Project</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="showSetup()">‚öôÔ∏è Reconfigure</button>
                            <button class="btn btn-green" onclick="generateReport()">üìÑ Generate Report</button>
                        </div>
                    </div>
                </div>

                <!-- Quick Summary -->
                <div class="total-card">
                    <h2 style="margin: 0 0 10px 0;">Grand Total</h2>
                    <div style="font-size: 48px; font-weight: bold;" id="grandTotal">$0</div>
                    <div style="opacity: 0.9; margin-top: 10px;" id="totalBreakdown">Project: $0 | Profit: $0 | Tax: $0</div>
                </div>

                <!-- Estimate Items -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #1f2937;">Estimate Line Items</h3>
                        <button class="btn btn-green" onclick="addItem()">‚ûï Add Item</button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table id="estimateTable">
                            <thead>
                                <tr>
                                    <th>Task Name</th>
                                    <th>Description</th>
                                    <th>Hours</th>
                                    <th>Rate ($/hr)</th>
                                    <th>Labor Total</th>
                                    <th>Materials</th>
                                    <th>Other Costs</th>
                                    <th>Line Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="estimateBody">
                                <!-- Items will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let itemCounter = 1;
        let laborRates = {
            'Project Manager': 150,
            'Superintendent': 100,
            'General Foreman': 95,
            'Foreman': 90,
            'Journeyman': 85,
            'Apprentice': 60
        };
        let projectSettings = {
            name: 'Commercial Construction Project',
            type: 'Commercial',
            location: '',
            profitMargin: 15,
            salesTax: 8.25,
            miscPercent: 5
        };
        let stateData = {
            'California': { salesTax: 7.25, wagePremium: 1.2 },
            'Texas': { salesTax: 6.25, wagePremium: 0.9 },
            'New York': { salesTax: 8.0, wagePremium: 1.15 },
            'Florida': { salesTax: 6.0, wagePremium: 0.95 },
            'Illinois': { salesTax: 6.25, wagePremium: 1.1 },
            'Nevada': { salesTax: 6.85, wagePremium: 1.05 },
            'Arizona': { salesTax: 5.6, wagePremium: 0.95 },
            'Colorado': { salesTax: 2.9, wagePremium: 1.0 },
            'Washington': { salesTax: 6.5, wagePremium: 1.1 },
            'Oregon': { salesTax: 0, wagePremium: 1.05 }
        };

        // Setup wizard functions
        function changeStep(direction) {
            if (direction === 1 && currentStep < 3) {
                currentStep++;
            } else if (direction === -1 && currentStep > 1) {
                currentStep--;
            }
            updateWizardDisplay();
        }

        function updateWizardDisplay() {
            // Hide all steps
            for (let i = 1; i <= 3; i++) {
                document.getElementById('stepContent' + i).style.display = 'none';
                document.getElementById('step' + i).className = 'step inactive';
            }
            
            // Show current step
            document.getElementById('stepContent' + currentStep).style.display = 'block';
            document.getElementById('step' + currentStep).className = 'step active';
            
            // Update buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < 3 ? 'block' : 'none';
            document.getElementById('startBtn').style.display = currentStep === 3 ? 'block' : 'none';
        }

        function startEstimating() {
            // Save settings
            projectSettings.name = document.getElementById('projectName').value;
            projectSettings.type = document.getElementById('projectType').value;
            projectSettings.location = document.getElementById('projectLocation').value;
            projectSettings.profitMargin = parseFloat(document.getElementById('profitMargin').value);
            projectSettings.salesTax = parseFloat(document.getElementById('salesTax').value);
            projectSettings.miscPercent = parseFloat(document.getElementById('miscPercent').value);

            // Save labor rates
            laborRates['Project Manager'] = parseFloat(document.getElementById('rate_manager').value);
            laborRates['Superintendent'] = parseFloat(document.getElementById('rate_super').value);
            laborRates['General Foreman'] = parseFloat(document.getElementById('rate_general').value);
            laborRates['Foreman'] = parseFloat(document.getElementById('rate_foreman').value);
            laborRates['Journeyman'] = parseFloat(document.getElementById('rate_journey').value);
            laborRates['Apprentice'] = parseFloat(document.getElementById('rate_apprentice').value);

            // Update project info display
            document.getElementById('projectInfo').textContent = 
                `${projectSettings.name} - ${projectSettings.location || 'Location not set'}`;

            // Hide wizard, show main app
            document.getElementById('setupWizard').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';

            // Add initial item
            addItem();
            updateTotals();
        }

        function showSetup() {
            document.getElementById('setupWizard').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            currentStep = 1;
            updateWizardDisplay();
        }

        // Handle state selection
        document.getElementById('projectLocation').addEventListener('change', function() {
            const state = this.value;
            if (stateData[state]) {
                // Update sales tax
                document.getElementById('salesTax').value = stateData[state].salesTax;
                
                // Adjust labor rates based on state premium
                const premium = stateData[state].wagePremium;
                const baseRates = [150, 100, 95, 90, 85, 60];
                const rateIds = ['rate_manager', 'rate_super', 'rate_general', 'rate_foreman', 'rate_journey', 'rate_apprentice'];
                
                rateIds.forEach((id, index) => {
                    document.getElementById(id).value = Math.round(baseRates[index] * premium);
                });
            }
        });

        // Main application functions
        function addItem() {
            const tbody = document.getElementById('estimateBody');
            const row = tbody.insertRow();
            const itemId = 'item_' + itemCounter++;
            
            row.innerHTML = `
                <td><input type="text" class="input-field" placeholder="Task name" onchange="updateTotals()"></td>
                <td><input type="text" class="input-field" placeholder="Description" onchange="updateTotals()"></td>
                <td><input type="number" class="input-field" placeholder="0" step="0.1" onchange="updateTotals()"></td>
                <td>
                    <select class="input-field" onchange="updateRate(this); updateTotals();">
                        <option value="85">Journeyman ($85)</option>
                        <option value="150">Project Manager ($150)</option>
                        <option value="100">Superintendent ($100)</option>
                        <option value="95">General Foreman ($95)</option>
                        <option value="90">Foreman ($90)</option>
                        <option value="60">Apprentice ($60)</option>
                    </select>
                </td>
                <td class="labor-total">$0</td>
                <td><input type="number" class="input-field material-cost" placeholder="0" step="0.01" onchange="updateTotals()"></td>
                <td><input type="number" class="input-field other-cost" placeholder="0" step="0.01" onchange="updateTotals()"></td>
                <td class="line-total font-bold">$0</td>
                <td><button class="btn btn-red" onclick="removeItem(this)" style="padding: 8px 12px;">üóëÔ∏è</button></td>
            `;
            
            updateTotals();
        }

        function removeItem(button) {
            const row = button.closest('tr');
            row.remove();
            updateTotals();
        }

        function updateRate(select) {
            // Rate is already in the select value
        }

        function updateTotals() {
            const rows = document.querySelectorAll('#estimateBody tr');
            let totalProject = 0;

            rows.forEach(row => {
                const hours = parseFloat(row.cells[2].querySelector('input').value) || 0;
                const rate = parseFloat(row.cells[3].querySelector('select').value) || 0;
                const materials = parseFloat(row.cells[5].querySelector('input').value) || 0;
                const other = parseFloat(row.cells[6].querySelector('input').value) || 0;

                const laborTotal = hours * rate;
                const lineTotal = laborTotal + materials + other;

                row.cells[4].textContent = '$' + laborTotal.toLocaleString();
                row.cells[7].textContent = '$' + lineTotal.toLocaleString();

                totalProject += lineTotal;
            });

            // Calculate final totals
            const miscCost = totalProject * (projectSettings.miscPercent / 100);
            const subtotalWithMisc = totalProject + miscCost;
            const profit = subtotalWithMisc * (projectSettings.profitMargin / 100);
            const subtotalWithProfit = subtotalWithMisc + profit;
            const tax = subtotalWithProfit * (projectSettings.salesTax / 100);
            const grandTotal = subtotalWithProfit + tax;

            // Update display
            document.getElementById('grandTotal').textContent = '$' + grandTotal.toLocaleString();
            document.getElementById('totalBreakdown').textContent = 
                `Project: $${totalProject.toLocaleString()} | Profit: $${profit.toLocaleString()} | Tax: $${tax.toLocaleString()}`;
        }

        function generateReport() {
            const rows = document.querySelectorAll('#estimateBody tr');
            let reportData = `CONSTRUCTION ESTIMATE REPORT\n`;
            reportData += `============================\n\n`;
            reportData += `Project: ${projectSettings.name}\n`;
            reportData += `Date: ${new Date().toLocaleDateString()}\n`;
            reportData += `Location: ${projectSettings.location || 'Not specified'}\n`;
            reportData += `Type: ${projectSettings.type}\n\n`;
            
            reportData += `ESTIMATE LINE ITEMS:\n`;
            reportData += `===================\n`;
            
            rows.forEach((row, index) => {
                const task = row.cells[0].querySelector('input').value || `Item ${index + 1}`;
                const desc = row.cells[1].querySelector('input').value || 'No description';
                const hours = row.cells[2].querySelector('input').value || '0';
                const rate = row.cells[3].querySelector('select').value || '0';
                const materials = row.cells[5].querySelector('input').value || '0';
                const other = row.cells[6].querySelector('input').value || '0';
                const total = row.cells[7].textContent;
                
                reportData += `\n${task}\n`;
                reportData += `Description: ${desc}\n`;
                reportData += `Labor: ${hours} hrs √ó $${rate}/hr = $${(hours * rate).toLocaleString()}\n`;
                reportData += `Materials: $${parseFloat(materials).toLocaleString()}\n`;
                reportData += `Other: $${parseFloat(other).toLocaleString()}\n`;
                reportData += `Total: ${total}\n`;
            });

            // Calculate totals for report
            let totalProject = 0;
            rows.forEach(row => {
                const hours = parseFloat(row.cells[2].querySelector('input').value) || 0;
                const rate = parseFloat(row.cells[3].querySelector('select').value) || 0;
                const materials = parseFloat(row.cells[5].querySelector('input').value) || 0;
                const other = parseFloat(row.cells[6].querySelector('input').value) || 0;
                totalProject += (hours * rate) + materials + other;
            });

            const miscCost = totalProject * (projectSettings.miscPercent / 100);
            const profit = (totalProject + miscCost) * (projectSettings.profitMargin / 100);
            const tax = (totalProject + miscCost + profit) * (projectSettings.salesTax / 100);
            const grandTotal = totalProject + miscCost + profit + tax;

            reportData += `\n\nFINANCIAL SUMMARY:\n`;
            reportData += `================\n`;
            reportData += `Project Subtotal: $${totalProject.toLocaleString()}\n`;
            reportData += `Miscellaneous (${projectSettings.miscPercent}%): $${miscCost.toLocaleString()}\n`;
            reportData += `Profit (${projectSettings.profitMargin}%): $${profit.toLocaleString()}\n`;
            reportData += `Sales Tax (${projectSettings.salesTax}%): $${tax.toLocaleString()}\n`;
            reportData += `\nGRAND TOTAL: $${grandTotal.toLocaleString()}\n`;

            // Download report
            const blob = new Blob([reportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `estimate_${projectSettings.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateWizardDisplay();
    </script>
</body>
</html>
