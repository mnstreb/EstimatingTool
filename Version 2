<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Estimate Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: system-ui, -apple-system, sans-serif; 
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 20px; }
        .input-field { 
            width: 100%; 
            padding: 8px 12px; 
            border: 2px solid #e5e7eb; 
            border-radius: 6px; 
            font-size: 14px;
        }
        .input-field:focus { 
            outline: none; 
            border-color: #3b82f6; 
        }
        .btn { 
            padding: 10px 20px; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer; 
            border: none;
            color: white;
        }
        .btn-primary { background: #3b82f6; }
        .btn-green { background: #059669; }
        .btn-red { background: #dc2626; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; }
        .setup-wizard {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .wizard-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
        }
        .step {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
        }
        .step.active { background: #3b82f6; color: white; }
        .step.inactive { background: #e5e7eb; color: #6b7280; }
        .form-group { margin-bottom: 20px; }
        .label { display: block; margin-bottom: 5px; font-weight: 600; color: #374151; }
    </style>
</head>
<body>
    <!-- Setup Wizard -->
    <div id="setupWizard" class="setup-wizard">
        <div class="wizard-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: #1f2937; margin-bottom: 10px;">üèóÔ∏è Project Setup</h1>
                <p style="color: #6b7280;">Configure your construction estimate</p>
            </div>

            <div style="display: flex; justify-content: center; margin-bottom: 30px;">
                <div class="step active" id="step1">1</div>
                <div class="step inactive" id="step2">2</div>
                <div class="step inactive" id="step3">3</div>
            </div>

            <!-- Step 1 -->
            <div id="stepContent1">
                <h2>Project Information</h2>
                <div class="form-group">
                    <label class="label">Project Name</label>
                    <input type="text" id="projectName" class="input-field" value="Commercial Construction Project">
                </div>
                <div class="form-group">
                    <label class="label">Project Type</label>
                    <select id="projectType" class="input-field">
                        <option value="Commercial">Commercial</option>
                        <option value="Residential">Residential</option>
                        <option value="Industrial">Industrial</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="label">State</label>
                    <select id="projectLocation" class="input-field">
                        <option value="">Select State</option>
                        <option value="California">California</option>
                        <option value="Texas">Texas</option>
                        <option value="New York">New York</option>
                        <option value="Florida">Florida</option>
                    </select>
                </div>
            </div>

            <!-- Step 2 -->
            <div id="stepContent2" style="display: none;">
                <h2>Labor Rates</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="label">Project Manager ($/hr)</label>
                        <input type="number" id="rate_manager" class="input-field" value="150">
                    </div>
                    <div class="form-group">
                        <label class="label">Superintendent ($/hr)</label>
                        <input type="number" id="rate_super" class="input-field" value="100">
                    </div>
                    <div class="form-group">
                        <label class="label">Foreman ($/hr)</label>
                        <input type="number" id="rate_foreman" class="input-field" value="90">
                    </div>
                    <div class="form-group">
                        <label class="label">Journeyman ($/hr)</label>
                        <input type="number" id="rate_journey" class="input-field" value="85">
                    </div>
                </div>
            </div>

            <!-- Step 3 -->
            <div id="stepContent3" style="display: none;">
                <h2>Project Settings</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="label">Profit Margin (%)</label>
                        <input type="number" id="profitMargin" class="input-field" value="15">
                    </div>
                    <div class="form-group">
                        <label class="label">Sales Tax (%)</label>
                        <input type="number" id="salesTax" class="input-field" value="8.25">
                    </div>
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                <button class="btn btn-primary" id="prevBtn" onclick="goBack()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="goNext()">Next</button>
                <button class="btn btn-green" id="startBtn" onclick="startApp()" style="display: none;">Start Estimating</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="container">
            <!-- Header -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="margin: 0; color: #1f2937;">üèóÔ∏è Construction Estimate Calculator</h1>
                        <p style="margin: 5px 0 0 0; color: #6b7280;" id="projectInfo">Project Info</p>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="showWizard()">‚öôÔ∏è Setup</button>
                        <button class="btn btn-green" onclick="downloadReport()">üìÑ Report</button>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; text-align: center;">
                    <h3 style="margin: 0 0 10px 0;">Grand Total</h3>
                    <div style="font-size: 32px; font-weight: bold;" id="grandTotal">$0</div>
                </div>
                <div class="card">
                    <h4 style="margin: 0 0 10px 0; color: #374151;">Project Costs</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Labor:</span>
                        <span id="laborTotal">$0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Materials:</span>
                        <span id="materialTotal">$0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Other:</span>
                        <span id="otherTotal">$0</span>
                    </div>
                </div>
                <div class="card">
                    <h4 style="margin: 0 0 10px 0; color: #374151;">Financial Summary</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Profit:</span>
                        <span id="profit">$0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Tax:</span>
                        <span id="tax">$0</span>
                    </div>
                </div>
            </div>

            <!-- Estimate Table -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">Estimate Line Items</h3>
                    <button class="btn btn-green" onclick="addRow()">‚ûï Add Item</button>
                </div>

                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Hours</th>
                                <th>Rate</th>
                                <th>Labor</th>
                                <th>Materials</th>
                                <th>Other</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="estimateBody">
                            <!-- Rows added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple global variables
        var currentStep = 1;
        var projectData = {
            name: 'Commercial Construction Project',
            type: 'Commercial',
            location: '',
            profitMargin: 15,
            salesTax: 8.25
        };

        // Step navigation
        function goNext() {
            if (currentStep < 3) {
                currentStep++;
                updateSteps();
            }
        }

        function goBack() {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        }

        function updateSteps() {
            // Hide all steps
            document.getElementById('stepContent1').style.display = 'none';
            document.getElementById('stepContent2').style.display = 'none';
            document.getElementById('stepContent3').style.display = 'none';

            // Show current step
            document.getElementById('stepContent' + currentStep).style.display = 'block';

            // Update step indicators
            for (var i = 1; i <= 3; i++) {
                var step = document.getElementById('step' + i);
                step.className = i === currentStep ? 'step active' : 'step inactive';
            }

            // Update buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < 3 ? 'block' : 'none';
            document.getElementById('startBtn').style.display = currentStep === 3 ? 'block' : 'none';
        }

        function startApp() {
            // Save project data
            projectData.name = document.getElementById('projectName').value;
            projectData.type = document.getElementById('projectType').value;
            projectData.location = document.getElementById('projectLocation').value;
            projectData.profitMargin = parseFloat(document.getElementById('profitMargin').value) || 15;
            projectData.salesTax = parseFloat(document.getElementById('salesTax').value) || 8.25;

            // Update project info
            document.getElementById('projectInfo').textContent = projectData.name + ' - ' + (projectData.location || 'No location');

            // Hide wizard, show app
            document.getElementById('setupWizard').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';

            // Add first row
            addRow();
        }

        function showWizard() {
            document.getElementById('setupWizard').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function addRow() {
            var tbody = document.getElementById('estimateBody');
            var row = tbody.insertRow();
            
            row.innerHTML = '<td><input type="text" class="input-field" placeholder="Task name" onchange="calculate()"></td>' +
                '<td><input type="number" class="input-field" placeholder="0" step="0.1" onchange="calculate()"></td>' +
                '<td><select class="input-field" onchange="calculate()"><option value="85">Journeyman ($85)</option><option value="150">Project Manager ($150)</option><option value="100">Superintendent ($100)</option><option value="90">Foreman ($90)</option></select></td>' +
                '<td class="labor-cell">$0</td>' +
                '<td><input type="number" class="input-field" placeholder="0" step="0.01" onchange="calculate()"></td>' +
                '<td><input type="number" class="input-field" placeholder="0" step="0.01" onchange="calculate()"></td>' +
                '<td class="total-cell">$0</td>' +
                '<td><button class="btn btn-red" onclick="removeRow(this)">üóëÔ∏è</button></td>';
            
            calculate();
        }

        function removeRow(button) {
            var row = button.closest('tr');
            row.remove();
            calculate();
        }

        function calculate() {
            var rows = document.querySelectorAll('#estimateBody tr');
            var totalLabor = 0;
            var totalMaterials = 0;
            var totalOther = 0;

            rows.forEach(function(row) {
                if (row.cells.length >= 7) {
                    var hours = parseFloat(row.cells[1].querySelector('input').value) || 0;
                    var rate = parseFloat(row.cells[2].querySelector('select').value) || 0;
                    var materials = parseFloat(row.cells[4].querySelector('input').value) || 0;
                    var other = parseFloat(row.cells[5].querySelector('input').value) || 0;

                    var labor = hours * rate;
                    var lineTotal = labor + materials + other;

                    row.cells[3].textContent = '$' + labor.toLocaleString();
                    row.cells[6].textContent = '$' + lineTotal.toLocaleString();

                    totalLabor += labor;
                    totalMaterials += materials;
                    totalOther += other;
                }
            });

            var subtotal = totalLabor + totalMaterials + totalOther;
            var profit = subtotal * (projectData.profitMargin / 100);
            var tax = (subtotal + profit) * (projectData.salesTax / 100);
            var grandTotal = subtotal + profit + tax;

            // Update displays
            document.getElementById('laborTotal').textContent = '$' + totalLabor.toLocaleString();
            document.getElementById('materialTotal').textContent = '$' + totalMaterials.toLocaleString();
            document.getElementById('otherTotal').textContent = '$' + totalOther.toLocaleString();
            document.getElementById('subtotal').textContent = '$' + subtotal.toLocaleString();
            document.getElementById('profit').textContent = '$' + profit.toLocaleString();
            document.getElementById('tax').textContent = '$' + tax.toLocaleString();
            document.getElementById('grandTotal').textContent = '$' + grandTotal.toLocaleString();
        }

        function downloadReport() {
            var content = 'CONSTRUCTION ESTIMATE REPORT\n';
            content += '============================\n\n';
            content += 'Project: ' + projectData.name + '\n';
            content += 'Date: ' + new Date().toLocaleDateString() + '\n\n';

            var rows = document.querySelectorAll('#estimateBody tr');
            rows.forEach(function(row, index) {
                if (row.cells.length >= 7) {
                    var task = row.cells[0].querySelector('input').value || 'Item ' + (index + 1);
                    var hours = row.cells[1].querySelector('input').value || '0';
                    var rate = row.cells[2].querySelector('select').value || '0';
                    var materials = row.cells[4].querySelector('input').value || '0';
                    var other = row.cells[5].querySelector('input').value || '0';
                    var total = row.cells[6].textContent;

                    content += task + '\n';
                    content += 'Labor: ' + hours + ' hrs √ó $' + rate + '/hr\n';
                    content += 'Materials: $' + materials + '\n';
                    content += 'Other: $' + other + '\n';
                    content += 'Total: ' + total + '\n\n';
                }
            });

            var blob = new Blob([content], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'estimate_' + new Date().toISOString().split('T')[0] + '.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateSteps();
    </script>
</body>
</html>
